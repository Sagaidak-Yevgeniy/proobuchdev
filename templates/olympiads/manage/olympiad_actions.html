{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block title %}{% trans 'Управление олимпиадой' %} - {{ olympiad.title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="mb-6">
        {% include 'components/olympiad_breadcrumbs.html' with olympiad=olympiad current='actions' %}
    </div>
    
    <div class="flex flex-col md:flex-row">
        <!-- Левая панель навигации -->
        <div class="w-full md:w-1/4 mb-6 md:mb-0 md:pr-6">
            <div class="bg-white dark:bg-gray-800 shadow-md rounded-lg overflow-hidden sticky top-4">
                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-blue-500 to-blue-600 text-white">
                    <div class="flex items-center">
                        <i class="fas fa-tasks-alt text-lg mr-2"></i>
                        <h2 class="text-lg font-medium">{% trans 'Инструменты управления' %}</h2>
                    </div>
                </div>
                <div class="p-4">
                    <nav class="space-y-2">
                        <a href="#" data-section="overview" class="olympiad-nav-link flex items-center p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i class="fas fa-home w-5 h-5 mr-2"></i>
                            <span>{% trans 'Обзор' %}</span>
                        </a>
                        <a href="#" data-section="edit" class="olympiad-nav-link flex items-center p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i class="fas fa-cog w-5 h-5 mr-2"></i>
                            <span>{% trans 'Настройки' %}</span>
                        </a>
                        <a href="#" data-section="tasks" class="olympiad-nav-link flex items-center p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i class="fas fa-list-check w-5 h-5 mr-2"></i>
                            <span>{% trans 'Задания' %}</span>
                        </a>
                        <a href="#" data-section="participants" class="olympiad-nav-link flex items-center p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i class="fas fa-users w-5 h-5 mr-2"></i>
                            <span>{% trans 'Участники' %}</span>
                        </a>
                        <a href="#" data-section="invitations" class="olympiad-nav-link flex items-center p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i class="fas fa-envelope-open-text w-5 h-5 mr-2"></i>
                            <span>{% trans 'Приглашения' %}</span>
                        </a>
                        <a href="#" data-section="statistics" class="olympiad-nav-link flex items-center p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i class="fas fa-chart-line w-5 h-5 mr-2"></i>
                            <span>{% trans 'Статистика' %}</span>
                        </a>
                        <a href="#" data-section="reports" class="olympiad-nav-link flex items-center p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i class="fas fa-file-export w-5 h-5 mr-2"></i>
                            <span>{% trans 'Отчеты' %}</span>
                        </a>
                        <a href="#" data-section="status" class="olympiad-nav-link flex items-center p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i class="fas fa-power-off w-5 h-5 mr-2"></i>
                            <span>{% trans 'Статус' %}</span>
                        </a>
                    </nav>
                </div>
            </div>
        </div>
        
        <!-- Правая панель с содержимым -->
        <div class="w-full md:w-3/4">
            <!-- Содержимое каждой секции -->
            
            <!-- Секция: Обзор (по умолчанию) -->
            <div id="section-overview" class="content-section">
                <h1 class="text-2xl font-bold mb-6 text-gray-900 dark:text-white">{{ olympiad.title }}</h1>
                
                <div class="p-4 mb-6 rounded-lg border-l-4 border-blue-500 bg-blue-50 dark:bg-blue-900/30 dark:border-blue-600">
                    <p class="text-gray-700 dark:text-gray-300">
                        {% if olympiad.status == 'draft' %}
                            {% trans 'Статус олимпиады: ' %}<span class="font-medium text-yellow-600 dark:text-yellow-400">{% trans 'Черновик' %}</span>
                        {% elif olympiad.status == 'published' %}
                            {% trans 'Статус олимпиады: ' %}<span class="font-medium text-blue-600 dark:text-blue-400">{% trans 'Опубликована' %}</span>
                        {% elif olympiad.status == 'active' %}
                            {% trans 'Статус олимпиады: ' %}<span class="font-medium text-green-600 dark:text-green-400">{% trans 'Активна' %}</span>
                        {% elif olympiad.status == 'completed' %}
                            {% trans 'Статус олимпиады: ' %}<span class="font-medium text-purple-600 dark:text-purple-400">{% trans 'Завершена' %}</span>
                        {% elif olympiad.status == 'archived' %}
                            {% trans 'Статус олимпиады: ' %}<span class="font-medium text-gray-600 dark:text-gray-400">{% trans 'Архивирована' %}</span>
                        {% endif %}
                    </p>
                    <div class="mt-2 flex flex-wrap">
                        <span class="inline-flex items-center mr-4 mb-2">
                            <i class="far fa-calendar mr-1 text-gray-500 dark:text-gray-400"></i>
                            <span class="text-gray-700 dark:text-gray-300">{% trans 'Начало:' %} {{ olympiad.start_datetime|date:"d.m.Y H:i" }}</span>
                        </span>
                        <span class="inline-flex items-center mr-4 mb-2">
                            <i class="far fa-calendar-check mr-1 text-gray-500 dark:text-gray-400"></i>
                            <span class="text-gray-700 dark:text-gray-300">{% trans 'Окончание:' %} {{ olympiad.end_datetime|date:"d.m.Y H:i" }}</span>
                        </span>
                        <span class="inline-flex items-center mb-2">
                            <i class="fas fa-tasks mr-1 text-gray-500 dark:text-gray-400"></i>
                            <span class="text-gray-700 dark:text-gray-300">{% trans 'Заданий:' %} {{ olympiad.tasks.count }}</span>
                        </span>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                
                <!-- Карточка настроек -->
                <div class="bg-white dark:bg-gray-800 shadow-md rounded-lg overflow-hidden action-card relative">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-blue-500 to-blue-600 text-white">
                        <div class="flex items-center">
                            <i class="fas fa-cog text-lg mr-2"></i>
                            <h2 class="text-lg font-medium">{% trans 'Настройки олимпиады' %}</h2>
                        </div>
                    </div>
                    <div class="p-6">
                        <p class="text-gray-700 dark:text-gray-300 mb-4">{% trans 'Управление основными параметрами олимпиады, включая название, описание, даты проведения и правила.' %}</p>
                        <a href="{% url 'olympiads:olympiad_edit' olympiad_id=olympiad.id %}" class="inline-flex items-center px-5 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 dark:focus:ring-blue-800 action-btn">
                            <i class="fas fa-cog mr-2"></i>
                            {% trans 'Изменить настройки' %}
                        </a>
                    </div>
                </div>
                
                <!-- Карточка управления заданиями -->
                <div class="bg-white dark:bg-gray-800 shadow-md rounded-lg overflow-hidden action-card relative">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-purple-500 to-purple-600 text-white">
                        <div class="flex items-center">
                            <i class="fas fa-tasks text-lg mr-2"></i>
                            <h2 class="text-lg font-medium">{% trans 'Задания олимпиады' %}</h2>
                        </div>
                    </div>
                    <div class="p-6">
                        <p class="text-gray-700 dark:text-gray-300 mb-4">{% trans 'Добавление, редактирование и управление заданиями олимпиады. Настройка тестовых случаев для проверки решений.' %}</p>
                        <a href="{% url 'olympiads:olympiad_tasks_manage' olympiad_id=olympiad.id %}" class="inline-flex items-center px-5 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-700 focus:ring-4 focus:ring-purple-300 dark:focus:ring-purple-800 action-btn">
                            <i class="fas fa-list-alt mr-2"></i>
                            {% trans 'Управлять заданиями' %}
                        </a>
                    </div>
                </div>
                
                <!-- Карточка активации/деактивации -->
                <div class="bg-white dark:bg-gray-800 shadow-md rounded-lg overflow-hidden action-card relative">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-green-500 to-green-600 text-white">
                        <div class="flex items-center">
                            <i class="fas fa-power-off text-lg mr-2"></i>
                            <h2 class="text-lg font-medium">{% trans 'Статус олимпиады' %}</h2>
                        </div>
                    </div>
                    <div class="p-6">
                        <p class="text-gray-700 dark:text-gray-300 mb-4">
                        {% if olympiad.status == 'active' %}
                            {% trans 'Олимпиада активна и доступна участникам. Вы можете деактивировать её.' %}
                        {% else %}
                            {% trans 'Олимпиада не активна. Активируйте её, чтобы сделать доступной для участников.' %}
                        {% endif %}
                        </p>
                        <button type="button" onclick="alert('{% trans 'Функция переключения статуса олимпиады в разработке' %}')" class="inline-flex items-center px-5 py-2.5 
                            {% if olympiad.status == 'active' %}
                                bg-amber-600 text-white rounded-lg hover:bg-amber-700 focus:ring-4 focus:ring-amber-300 dark:focus:ring-amber-800
                            {% else %}
                                bg-green-600 text-white rounded-lg hover:bg-green-700 focus:ring-4 focus:ring-green-300 dark:focus:ring-green-800
                            {% endif %} action-btn">
                                <i class="fas {% if olympiad.status == 'active' %}fa-power-off{% else %}fa-play{% endif %} mr-2"></i>
                                {% if olympiad.status == 'active' %}
                                    {% trans 'Деактивировать' %}
                                {% else %}
                                    {% trans 'Активировать' %}
                                {% endif %}
                        </button>
                    </div>
                </div>
                
                <!-- Карточка участников -->
                <div class="bg-white dark:bg-gray-800 shadow-md rounded-lg overflow-hidden action-card relative">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-cyan-500 to-cyan-600 text-white">
                        <div class="flex items-center">
                            <i class="fas fa-users text-lg mr-2"></i>
                            <h2 class="text-lg font-medium">{% trans 'Участники и приглашения' %}</h2>
                        </div>
                    </div>
                    <div class="p-6">
                        <p class="text-gray-700 dark:text-gray-300 mb-4">{% trans 'Управление участниками олимпиады, просмотр статистики и создание пригласительных кодов.' %}</p>
                        <div class="flex flex-wrap gap-3">
                            <a href="{% url 'olympiads:olympiad_participants' olympiad_id=olympiad.id %}" class="inline-flex items-center px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 focus:ring-4 focus:ring-cyan-300 dark:focus:ring-cyan-800 action-btn">
                                <i class="fas fa-user-friends mr-2"></i>
                                {% trans 'Участники' %}
                            </a>
                            <a href="{% url 'olympiads:olympiad_invitations' olympiad_id=olympiad.id %}" class="inline-flex items-center px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 focus:ring-4 focus:ring-teal-300 dark:focus:ring-teal-800 action-btn">
                                <i class="fas fa-envelope-open-text mr-2"></i>
                                {% trans 'Приглашения' %}
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Карточка статистики -->
                <div class="bg-white dark:bg-gray-800 shadow-md rounded-lg overflow-hidden action-card relative">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-indigo-500 to-indigo-600 text-white">
                        <div class="flex items-center">
                            <i class="fas fa-chart-pie text-lg mr-2"></i>
                            <h2 class="text-lg font-medium">{% trans 'Статистика и отчеты' %}</h2>
                        </div>
                    </div>
                    <div class="p-6">
                        <p class="text-gray-700 dark:text-gray-300 mb-4">{% trans 'Просмотр подробной статистики по олимпиаде, экспорт отчетов о результатах и активности участников.' %}</p>
                        <div class="flex flex-wrap gap-3">
                            <button type="button" onclick="alert('{% trans 'Функция статистики олимпиады в разработке' %}')" class="inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 focus:ring-4 focus:ring-indigo-300 dark:focus:ring-indigo-800 action-btn">
                                <i class="fas fa-chart-line mr-2"></i>
                                {% trans 'Статистика' %}
                            </button>
                            <button type="button" onclick="alert('{% trans 'Функция отчетов олимпиады в разработке' %}')" class="inline-flex items-center px-4 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 focus:ring-4 focus:ring-violet-300 dark:focus:ring-violet-800 action-btn">
                                <i class="fas fa-file-export mr-2"></i>
                                {% trans 'Отчеты' %}
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Карточка завершения/архивации -->
                <div class="bg-white dark:bg-gray-800 shadow-md rounded-lg overflow-hidden action-card relative">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-gray-500 to-gray-600 text-white">
                        <div class="flex items-center">
                            <i class="fas fa-archive text-lg mr-2"></i>
                            <h2 class="text-lg font-medium">{% trans 'Завершение олимпиады' %}</h2>
                        </div>
                    </div>
                    <div class="p-6">
                        <p class="text-gray-700 dark:text-gray-300 mb-4">{% trans 'Завершение олимпиады и перевод её в архив. Результаты останутся доступны для просмотра.' %}</p>
                        <div class="grid grid-cols-2 gap-3">
                            <button type="button" onclick="alert('{% trans 'Функция завершения олимпиады в разработке' %}')" class="inline-flex items-center justify-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 focus:ring-4 focus:ring-gray-300 dark:focus:ring-gray-800 action-btn">
                                <i class="fas fa-flag-checkered mr-2"></i>
                                {% trans 'Завершить' %}
                            </button>
                            <button type="button" onclick="alert('{% trans 'Функция архивации олимпиады в разработке' %}')" class="inline-flex items-center justify-center px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 focus:ring-4 focus:ring-gray-300 dark:focus:ring-gray-800 action-btn">
                                <i class="fas fa-archive mr-2"></i>
                                {% trans 'Архивировать' %}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
            
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Получаем все навигационные ссылки
        const navLinks = document.querySelectorAll('.olympiad-nav-link');
        // Получаем все секции содержимого
        const contentSections = document.querySelectorAll('.content-section');
        
        // Функция для активации секции
        function activateSection(sectionId) {
            // Скрываем все секции
            contentSections.forEach(section => {
                section.classList.add('hidden');
            });
            
            // Удаляем активный класс у всех ссылок
            navLinks.forEach(link => {
                link.classList.remove('bg-blue-100', 'dark:bg-gray-700', 'text-blue-700', 'dark:text-blue-400', 'active-nav-link');
            });
            
            // Показываем выбранную секцию
            const targetSection = document.getElementById('section-' + sectionId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            
            // Активируем соответствующую ссылку
            const activeLink = document.querySelector('.olympiad-nav-link[data-section="' + sectionId + '"]');
            if (activeLink) {
                activeLink.classList.add('bg-blue-100', 'dark:bg-gray-700', 'text-blue-700', 'dark:text-blue-400', 'active-nav-link');
            }
            
            // Сохраняем активную секцию в sessionStorage (не в localStorage, чтобы избежать проблем между вкладками)
            sessionStorage.setItem('olympiadActiveSection_' + {{ olympiad.id }}, sectionId);
        }
        
        // Добавляем обработчики событий для всех навигационных ссылок
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const sectionId = this.getAttribute('data-section');
                activateSection(sectionId);
            });
        });
        
        // При загрузке страницы проверяем, есть ли сохраненная активная секция в sessionStorage
        const savedSection = sessionStorage.getItem('olympiadActiveSection_' + {{ olympiad.id }});
        
        if (savedSection && document.getElementById('section-' + savedSection)) {
            // Если есть сохраненная секция, активируем её
            activateSection(savedSection);
        } else {
            // Иначе активируем секцию "Обзор" по умолчанию
            activateSection('overview');
        }
    });
</script>
{% endblock %}