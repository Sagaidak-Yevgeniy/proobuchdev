{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block title %}{% trans 'Управление олимпиадой' %} | {{ olympiad.title }}{% endblock %}

{% block extra_head %}
<style>
    /* Основные стили */
    .sidebar {
        height: calc(100vh - 80px);
        position: sticky;
        top: 80px;
    }
    
    /* Стили для навигации */
    .sidebar-nav-item {
        border-radius: 8px;
        margin-bottom: 4px;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        padding: 10px 16px;
        color: #4b5563;
        position: relative;
        overflow: hidden;
    }
    
    .dark .sidebar-nav-item {
        color: #e5e7eb;
    }
    
    .sidebar-nav-item:hover {
        background-color: rgba(243, 244, 246, 0.8);
    }
    
    .dark .sidebar-nav-item:hover {
        background-color: rgba(55, 65, 81, 0.5);
    }
    
    .sidebar-nav-item.active {
        background-color: rgba(219, 234, 254, 0.6);
        color: #3b82f6;
        font-weight: 500;
    }
    
    .dark .sidebar-nav-item.active {
        background-color: rgba(30, 58, 138, 0.3);
        color: #93c5fd;
    }
    
    .sidebar-nav-item.active::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 4px;
        background: linear-gradient(to bottom, #3b82f6, #6366f1);
        border-radius: 0 2px 2px 0;
    }
    
    .sidebar-nav-item i {
        font-size: 1.1rem;
        margin-right: 12px;
        width: 24px;
        text-align: center;
        opacity: 0.8;
    }
    
    /* Стили для разделов */
    .content-section {
        display: none !important;
    }
    
    .content-section.active {
        display: block !important;
        animation: fadeIn 0.3s ease-in-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    /* Стили для уведомлений */
    .notification-toast {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        display: flex;
        align-items: center;
        animation: slideIn 0.3s ease, slideOut 0.3s ease 2.7s forwards;
    }
    
    @keyframes slideIn {
        from { transform: translateY(100%); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    
    @keyframes slideOut {
        from { transform: translateY(0); opacity: 1; }
        to { transform: translateY(100%); opacity: 0; }
    }
    
    /* Стили для карточек */
    .olympiad-card {
        border-radius: 10px;
        overflow: hidden;
        transition: all 0.3s ease;
    }
    
    .olympiad-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    /* Стили для кнопок */
    .btn-action {
        transition: all 0.2s ease;
    }
    
    .btn-action:hover {
        transform: scale(1.05);
    }
    
    /* Иконки состояний */
    .status-badge {
        position: absolute;
        top: 10px;
        right: 10px;
    }
    
    /* Дизайн форм */
    .form-input {
        transition: border-color 0.2s ease;
    }
    
    .form-input:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    /* Индикаторы статуса */
    .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 8px;
    }
    
    .status-draft { background-color: #fbbf24; }
    .status-published { background-color: #3b82f6; }
    .status-active { background-color: #10b981; }
    .status-completed { background-color: #8b5cf6; }
    .status-archived { background-color: #9ca3af; }
    
    /* Стили для вкладок заданий */
    .task-tab-content {
        display: block;
        animation: fadeIn 0.3s ease-in-out;
    }
    
    .task-tab-content.hidden {
        display: none;
    }
    
    .active-tab-btn {
        border-bottom: 2px solid #3b82f6;
        font-weight: 500;
    }
    
    .task-form-pane {
        display: block;
    }
    
    .task-form-pane.hidden {
        display: none;
    }
    
    .btn-primary {
        background-color: #3b82f6;
        color: white;
        border-radius: 0.375rem;
        padding: 0.5rem 1rem;
        font-weight: 500;
        transition: all 0.2s;
    }
    
    .btn-primary:hover {
        background-color: #2563eb;
    }
    
    .btn-secondary {
        background-color: #e5e7eb;
        color: #4b5563;
        border-radius: 0.375rem;
        padding: 0.5rem 1rem;
        font-weight: 500;
        transition: all 0.2s;
    }
    
    .btn-secondary:hover {
        background-color: #d1d5db;
    }
    
    .btn-secondary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6">
    <!-- Хлебные крошки -->
    <nav class="flex mb-6 text-sm text-gray-500 dark:text-gray-400">
        <ol class="inline-flex items-center space-x-1 md:space-x-3">
            <li class="inline-flex items-center">
                <a href="{% url 'home' %}" class="inline-flex items-center hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-home mr-2"></i>
                    {% trans 'Главная' %}
                </a>
            </li>
            <li>
                <div class="flex items-center">
                    <i class="fas fa-chevron-right mx-2 text-gray-400"></i>
                    <a href="{% url 'olympiads:olympiad_list' %}" class="hover:text-gray-700 dark:hover:text-gray-300">
                        {% trans 'Олимпиады' %}
                    </a>
                </div>
            </li>
            <li>
                <div class="flex items-center">
                    <i class="fas fa-chevron-right mx-2 text-gray-400"></i>
                    <a href="{% url 'olympiads:olympiad_manage_list' %}" class="hover:text-gray-700 dark:hover:text-gray-300">
                        {% trans 'Управление олимпиадами' %}
                    </a>
                </div>
            </li>
            <li>
                <div class="flex items-center">
                    <i class="fas fa-chevron-right mx-2 text-gray-400"></i>
                    <a href="{% url 'olympiads:olympiad_detail' olympiad_id=olympiad.id %}" class="hover:text-gray-700 dark:hover:text-gray-300">
                        {{ olympiad.title|truncatechars:20 }}
                    </a>
                </div>
            </li>
            <li aria-current="page">
                <div class="flex items-center">
                    <i class="fas fa-chevron-right mx-2 text-gray-400"></i>
                    <span class="text-gray-800 dark:text-gray-200" id="breadcrumb-current">
                        {% trans 'Управление' %}
                    </span>
                </div>
            </li>
        </ol>
    </nav>
    
    <!-- Шапка страницы -->
    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl shadow-xl mb-8 overflow-hidden">
        <div class="p-6 text-white">
            <div class="flex flex-wrap items-center justify-between gap-4">
                <div class="flex items-center">
                    <div class="flex items-center justify-center w-14 h-14 bg-white/20 backdrop-blur-sm rounded-xl mr-4 shadow-inner">
                        <i class="fas fa-shield-alt text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">{% trans 'Управление олимпиадой' %}</h1>
                        <div class="flex items-center mt-1">
                            <div class="status-indicator 
                                {% if olympiad.status == 'draft' %}status-draft
                                {% elif olympiad.status == 'published' %}status-published
                                {% elif olympiad.status == 'active' %}status-active
                                {% elif olympiad.status == 'completed' %}status-completed
                                {% elif olympiad.status == 'archived' %}status-archived
                                {% endif %}"></div>
                            <p class="text-purple-100">{{ olympiad.title }} <span class="opacity-70">&middot; {{ olympiad.get_status_display }}</span></p>
                        </div>
                    </div>
                </div>
                
                <div class="flex flex-wrap items-center gap-3">
                    <a href="{% url 'olympiads:olympiad_detail' olympiad_id=olympiad.id %}" class="px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-white shadow-md transition-all flex items-center">
                        <i class="fas fa-eye mr-2"></i> {% trans 'Просмотр' %}
                    </a>
                    <a href="{% url 'olympiads:olympiad_manage_list' %}" class="px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-white shadow-md transition-all flex items-center">
                        <i class="fas fa-list mr-2"></i> {% trans 'Все олимпиады' %}
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="grid grid-cols-1 lg:grid-cols-4 xl:grid-cols-5 gap-8">
        <!-- Левая колонка с навигацией -->
        <div class="lg:col-span-1">
            <div class="sidebar space-y-6">
                <!-- Навигация по разделам -->
                <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-750">
                        <h3 class="text-lg font-medium text-gray-900 dark:text-white">{% trans 'Навигация' %}</h3>
                    </div>
                    <div class="p-3">
                        <nav>
                            <a href="#overview" data-section="overview" class="sidebar-nav-item">
                                <i class="fas fa-th-large text-purple-500"></i>
                                <span>{% trans 'Обзор' %}</span>
                            </a>
                            <a href="#edit" data-section="edit" class="sidebar-nav-item">
                                <i class="fas fa-edit text-blue-500"></i>
                                <span>{% trans 'Редактирование' %}</span>
                            </a>
                            <a href="#tasks" data-section="tasks" class="sidebar-nav-item">
                                <i class="fas fa-tasks text-emerald-500"></i>
                                <span>{% trans 'Задания' %}</span>
                            </a>
                            <a href="#participants" data-section="participants" class="sidebar-nav-item">
                                <i class="fas fa-users text-cyan-500"></i>
                                <span>{% trans 'Участники' %}</span>
                            </a>
                            <a href="#invitations" data-section="invitations" class="sidebar-nav-item">
                                <i class="fas fa-envelope-open-text text-teal-500"></i>
                                <span>{% trans 'Приглашения' %}</span>
                            </a>
                            <a href="#statistics" data-section="statistics" class="sidebar-nav-item">
                                <i class="fas fa-chart-line text-indigo-500"></i>
                                <span>{% trans 'Статистика' %}</span>
                            </a>
                            <a href="#reports" data-section="reports" class="sidebar-nav-item">
                                <i class="fas fa-file-export text-violet-500"></i>
                                <span>{% trans 'Отчеты' %}</span>
                            </a>
                            <a href="#status" data-section="status" class="sidebar-nav-item">
                                <i class="fas fa-power-off text-red-500"></i>
                                <span>{% trans 'Статус' %}</span>
                            </a>
                        </nav>
                    </div>
                </div>
                
                <!-- Информация об олимпиаде -->
                <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-750">
                        <h3 class="text-lg font-medium text-gray-900 dark:text-white">{% trans 'Информация' %}</h3>
                    </div>
                    <div class="p-4 space-y-3">
                        <div class="flex items-center justify-between py-2 border-b border-gray-200 dark:border-gray-700">
                            <span class="text-gray-700 dark:text-gray-300">{% trans 'Статус:' %}</span>
                            <span class="px-2.5 py-1 rounded-full text-xs font-medium
                                {% if olympiad.status == 'draft' %}bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300
                                {% elif olympiad.status == 'published' %}bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300
                                {% elif olympiad.status == 'active' %}bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300
                                {% elif olympiad.status == 'completed' %}bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300
                                {% elif olympiad.status == 'archived' %}bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300
                                {% endif %}">
                                {{ olympiad.get_status_display }}
                            </span>
                        </div>
                        <div class="flex items-center justify-between py-2 border-b border-gray-200 dark:border-gray-700">
                            <span class="text-gray-700 dark:text-gray-300">{% trans 'Создана:' %}</span>
                            <span class="text-gray-800 dark:text-gray-200">{{ olympiad.created_at|date:"d.m.Y" }}</span>
                        </div>
                        <div class="flex items-center justify-between py-2 border-b border-gray-200 dark:border-gray-700">
                            <span class="text-gray-700 dark:text-gray-300">{% trans 'Начало:' %}</span>
                            <span class="text-gray-800 dark:text-gray-200">{{ olympiad.start_datetime|date:"d.m.Y H:i" }}</span>
                        </div>
                        <div class="flex items-center justify-between py-2 border-b border-gray-200 dark:border-gray-700">
                            <span class="text-gray-700 dark:text-gray-300">{% trans 'Окончание:' %}</span>
                            <span class="text-gray-800 dark:text-gray-200">{{ olympiad.end_datetime|date:"d.m.Y H:i" }}</span>
                        </div>
                        <div class="flex items-center justify-between py-2">
                            <span class="text-gray-700 dark:text-gray-300">{% trans 'Заданий:' %}</span>
                            <span class="text-gray-800 dark:text-gray-200">{{ olympiad.tasks.count }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Правая колонка с содержимым разделов -->
        <div class="lg:col-span-3 xl:col-span-4">
            <!-- Секция: Обзор -->
            <div id="section-overview" class="content-section active">
                <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                    <!-- Карточка редактирования олимпиады -->
                    <div class="olympiad-card bg-white dark:bg-gray-800 shadow-lg relative">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-blue-500 to-blue-600 text-white">
                            <div class="flex items-center">
                                <i class="fas fa-edit text-xl mr-3"></i>
                                <h2 class="text-lg font-medium">{% trans 'Настройки олимпиады' %}</h2>
                            </div>
                        </div>
                        <div class="p-6">
                            <p class="text-gray-700 dark:text-gray-300 mb-5">{% trans 'Редактирование информации об олимпиаде, включая название, описание и даты проведения.' %}</p>
                            <a href="#edit" data-section="edit" class="btn-action inline-flex items-center px-4 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors w-full justify-center">
                                <i class="fas fa-pen-to-square mr-2"></i> {% trans 'Редактировать' %}
                            </a>
                        </div>
                    </div>
                    
                    <!-- Карточка управления заданиями -->
                    <div class="olympiad-card bg-white dark:bg-gray-800 shadow-lg relative">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white">
                            <div class="flex items-center">
                                <i class="fas fa-tasks text-xl mr-3"></i>
                                <h2 class="text-lg font-medium">{% trans 'Задания олимпиады' %}</h2>
                            </div>
                        </div>
                        <div class="p-6">
                            <p class="text-gray-700 dark:text-gray-300 mb-5">{% trans 'Управление заданиями, добавление тестовых случаев, редактирование условий.' %}</p>
                            <a href="#tasks" data-section="tasks" class="btn-action inline-flex items-center px-4 py-2.5 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors w-full justify-center">
                                <i class="fas fa-list-check mr-2"></i> {% trans 'Управление заданиями' %}
                            </a>
                        </div>
                    </div>
                    
                    <!-- Карточка участников -->
                    <div class="olympiad-card bg-white dark:bg-gray-800 shadow-lg relative">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-cyan-500 to-cyan-600 text-white">
                            <div class="flex items-center">
                                <i class="fas fa-users text-xl mr-3"></i>
                                <h2 class="text-lg font-medium">{% trans 'Участники' %}</h2>
                            </div>
                        </div>
                        <div class="p-6">
                            <p class="text-gray-700 dark:text-gray-300 mb-5">{% trans 'Просмотр участников олимпиады, их результатов, создание приглашений.' %}</p>
                            <a href="#participants" data-section="participants" class="btn-action inline-flex items-center px-4 py-2.5 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors w-full justify-center">
                                <i class="fas fa-user-group mr-2"></i> {% trans 'Управлять участниками' %}
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Карточки со статистикой -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mt-6">
                    <!-- Статистика: Всего заданий -->
                    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl p-6">
                        <div class="flex items-center">
                            <div class="mr-4 bg-blue-100 dark:bg-blue-900 p-3 rounded-lg">
                                <i class="fas fa-tasks text-blue-600 dark:text-blue-300 text-xl"></i>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400">{% trans 'Всего заданий' %}</p>
                                <h3 class="text-xl font-bold text-gray-900 dark:text-white">{{ olympiad.tasks.count }}</h3>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Статистика: Участников -->
                    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl p-6">
                        <div class="flex items-center">
                            <div class="mr-4 bg-green-100 dark:bg-green-900 p-3 rounded-lg">
                                <i class="fas fa-users text-green-600 dark:text-green-300 text-xl"></i>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400">{% trans 'Участников' %}</p>
                                <h3 class="text-xl font-bold text-gray-900 dark:text-white">{{ olympiad.participants.count }}</h3>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Статистика: Решено заданий -->
                    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl p-6">
                        <div class="flex items-center">
                            <div class="mr-4 bg-purple-100 dark:bg-purple-900 p-3 rounded-lg">
                                <i class="fas fa-check-circle text-purple-600 dark:text-purple-300 text-xl"></i>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400">{% trans 'Решено заданий' %}</p>
                                <h3 class="text-xl font-bold text-gray-900 dark:text-white">{{ solved_tasks_count|default:0 }}</h3>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Статистика: Среднее время решения -->
                    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl p-6">
                        <div class="flex items-center">
                            <div class="mr-4 bg-yellow-100 dark:bg-yellow-900 p-3 rounded-lg">
                                <i class="fas fa-clock text-yellow-600 dark:text-yellow-300 text-xl"></i>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400">{% trans 'Среднее время' %}</p>
                                <h3 class="text-xl font-bold text-gray-900 dark:text-white">{{ avg_solution_time|default:'н/д' }}</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Секция: Редактирование -->
            <div id="section-edit" class="content-section">
                <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-blue-500 to-blue-600 text-white">
                        <h2 class="text-xl font-semibold flex items-center">
                            <i class="fas fa-edit mr-3"></i> {% trans 'Редактирование олимпиады' %}
                        </h2>
                    </div>
                    <div class="p-6">
                        <form method="post" action="{% url 'olympiads:olympiad_edit' olympiad_id=olympiad.id %}" class="space-y-6">
                            {% csrf_token %}
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="id_title" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{% trans 'Название олимпиады' %}</label>
                                    <input type="text" name="title" id="id_title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" value="{{ olympiad.title }}" required>
                                </div>
                                <div>
                                    <label for="id_category" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{% trans 'Категория' %}</label>
                                    <select name="category" id="id_category" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                        <option value="">-- {% trans 'Без категории' %} --</option>
                                        {% for category in categories %}
                                            <option value="{{ category.id }}" {% if olympiad.category_id == category.id %}selected{% endif %}>{{ category.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            
                            <div>
                                <label for="id_description" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{% trans 'Описание' %}</label>
                                <textarea name="description" id="id_description" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400" required>{{ olympiad.description }}</textarea>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="id_start_date" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{% trans 'Дата начала' %}</label>
                                    <input type="datetime-local" name="start_datetime" id="id_start_date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" value="{{ olympiad.start_datetime|date:'Y-m-d\TH:i' }}" required>
                                </div>
                                <div>
                                    <label for="id_end_date" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{% trans 'Дата окончания' %}</label>
                                    <input type="datetime-local" name="end_datetime" id="id_end_date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" value="{{ olympiad.end_datetime|date:'Y-m-d\TH:i' }}" required>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <label for="id_difficulty" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{% trans 'Сложность' %}</label>
                                    <select name="difficulty" id="id_difficulty" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                        <option value="easy" {% if olympiad.difficulty == 'easy' %}selected{% endif %}>{% trans 'Лёгкая' %}</option>
                                        <option value="medium" {% if olympiad.difficulty == 'medium' %}selected{% endif %}>{% trans 'Средняя' %}</option>
                                        <option value="hard" {% if olympiad.difficulty == 'hard' %}selected{% endif %}>{% trans 'Сложная' %}</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="id_status" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{% trans 'Статус' %}</label>
                                    <select name="status" id="id_status" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                        <option value="draft" {% if olympiad.status == 'draft' %}selected{% endif %}>{% trans 'Черновик' %}</option>
                                        <option value="published" {% if olympiad.status == 'published' %}selected{% endif %}>{% trans 'Опубликовано' %}</option>
                                        <option value="active" {% if olympiad.status == 'active' %}selected{% endif %}>{% trans 'Активно' %}</option>
                                        <option value="completed" {% if olympiad.status == 'completed' %}selected{% endif %}>{% trans 'Завершено' %}</option>
                                        <option value="archived" {% if olympiad.status == 'archived' %}selected{% endif %}>{% trans 'Архив' %}</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="id_visibility" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{% trans 'Доступ' %}</label>
                                    <select name="visibility" id="id_visibility" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                        <option value="public" {% if olympiad.visibility == 'public' %}selected{% endif %}>{% trans 'Публичный' %}</option>
                                        <option value="private" {% if olympiad.visibility == 'private' %}selected{% endif %}>{% trans 'По приглашению' %}</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="flex justify-end">
                                <button type="submit" class="btn-action inline-flex items-center px-5 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-save mr-2"></i> {% trans 'Сохранить изменения' %}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Секция: Задания -->
            <div id="section-tasks" class="content-section">
                <!-- Боковая навигация для управления заданиями -->
                <div class="mb-6">
                    <div class="grid grid-cols-4 gap-2">
                        <button id="tasks-list-btn" class="btn-primary tasks-nav-btn active-tab-btn" data-tab="tasks-list">
                            <i class="fas fa-list-ul mr-2"></i>{% trans 'Список заданий' %}
                        </button>
                        <button id="add-task-btn" class="btn-secondary tasks-nav-btn" data-tab="add-task">
                            <i class="fas fa-plus mr-2"></i>{% trans 'Новое задание' %}
                        </button>
                        <button id="edit-task-btn" class="btn-secondary tasks-nav-btn" data-tab="edit-task" disabled>
                            <i class="fas fa-edit mr-2"></i>{% trans 'Редактирование' %}
                        </button>
                        <button id="test-cases-btn" class="btn-secondary tasks-nav-btn" data-tab="test-cases" disabled>
                            <i class="fas fa-vial mr-2"></i>{% trans 'Тесты' %}
                        </button>
                    </div>
                </div>
                
                <!-- Вкладка со списком заданий -->
                <div id="tasks-list-content" class="task-tab-content">
                    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl overflow-hidden mb-6">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white">
                            <div class="flex justify-between items-center">
                                <h2 class="text-xl font-semibold flex items-center">
                                    <i class="fas fa-tasks mr-3"></i> {% trans 'Управление заданиями' %}
                                </h2>
                                <button id="add-task-btn-inline" class="inline-flex items-center px-3 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-white transition-all">
                                    <i class="fas fa-plus mr-2"></i> {% trans 'Добавить задание' %}
                                </button>
                            </div>
                        </div>
                        <div class="p-6">
                            {% if olympiad.tasks.all %}
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-700">
                                            <tr>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                    {% trans 'Название' %}
                                                </th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                    {% trans 'Тип' %}
                                                </th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                    {% trans 'Сложность' %}
                                                </th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                    {% trans 'Баллы' %}
                                                </th>
                                                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                    {% trans 'Действия' %}
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            {% for task in olympiad.tasks.all %}
                                                <tr class="task-row" data-task-id="{{ task.id }}" data-task-title="{{ task.title }}" data-task-type="{{ task.task_type }}">
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <div class="text-sm font-medium text-gray-900 dark:text-white">{{ task.title }}</div>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                                            {% if task.task_type == 'programming' %}bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300
                                                            {% elif task.task_type == 'multiple_choice' %}bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300
                                                            {% elif task.task_type == 'theoretical' %}bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-300
                                                            {% endif %}">
                                                            {{ task.get_task_type_display }}
                                                        </span>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <div class="flex">
                                                            {% for i in "12345" %}
                                                                {% if forloop.counter <= task.difficulty %}
                                                                    <i class="fas fa-star text-yellow-500 text-xs"></i>
                                                                {% else %}
                                                                    <i class="far fa-star text-gray-400 text-xs"></i>
                                                                {% endif %}
                                                            {% endfor %}
                                                        </div>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <div class="text-sm text-gray-900 dark:text-white">{{ task.points }}</div>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm">
                                                        <button class="edit-task-btn text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300 px-2">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button class="test-cases-btn text-emerald-600 hover:text-emerald-900 dark:text-emerald-400 dark:hover:text-emerald-300 px-2" {% if task.task_type != 'programming' %}style="display:none"{% endif %}>
                                                            <i class="fas fa-vial"></i>
                                                        </button>
                                                        <button class="delete-task-btn text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 px-2">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% else %}
                                <div class="text-center py-8">
                                    <div class="text-gray-400 dark:text-gray-500 text-5xl mb-4">
                                        <i class="fas fa-tasks"></i>
                                    </div>
                                    <h3 class="text-xl font-medium text-gray-500 dark:text-gray-400 mb-2">{% trans 'Нет заданий' %}</h3>
                                    <p class="text-gray-500 dark:text-gray-400 mb-6">{% trans 'В этой олимпиаде пока нет заданий. Добавьте задания, чтобы участники могли приступить к их выполнению.' %}</p>
                                    <button id="no-tasks-add-btn" class="btn-primary inline-flex items-center px-4 py-2">
                                        <i class="fas fa-plus mr-2"></i> {% trans 'Добавить первое задание' %}
                                    </button>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Вкладка создания нового задания -->
                <div id="add-task-content" class="task-tab-content hidden">
                    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-green-500 to-emerald-600 text-white">
                            <h2 class="text-xl font-semibold flex items-center">
                                <i class="fas fa-plus-circle mr-3"></i> {% trans 'Добавление нового задания' %}
                            </h2>
                        </div>
                        
                        <div class="p-6">
                            <form id="add-task-form" method="post" action="{% url 'olympiads:olympiad_task_create' olympiad_id=olympiad.id %}" class="space-y-6">
                                {% csrf_token %}
                                
                                <!-- Навигация по вкладкам формы -->
                                <div class="border-b border-gray-200 dark:border-gray-700 mb-6">
                                    <ul class="flex flex-wrap -mb-px" id="taskFormTabs" role="tablist">
                                        <li class="mr-2" role="presentation">
                                            <button type="button" class="inline-block p-4 tab-active" id="task-basic-tab" data-tab="task-basic" role="tab" aria-selected="true">
                                                <i class="fas fa-info-circle mr-2"></i>{% trans 'Основная информация' %}
                                            </button>
                                        </li>
                                        <li class="mr-2" role="presentation">
                                            <button type="button" class="inline-block p-4" id="task-content-tab" data-tab="task-content" role="tab" aria-selected="false">
                                                <i class="fas fa-file-alt mr-2"></i>{% trans 'Контент задания' %}
                                            </button>
                                        </li>
                                        <li class="mr-2" role="presentation">
                                            <button type="button" class="inline-block p-4" id="task-settings-tab" data-tab="task-settings" role="tab" aria-selected="false">
                                                <i class="fas fa-cog mr-2"></i>{% trans 'Настройки' %}
                                            </button>
                                        </li>
                                    </ul>
                                </div>
                                
                                <!-- Содержимое вкладок формы -->
                                <div class="task-form-content">
                                    <!-- Вкладка с основной информацией -->
                                    <div class="task-form-pane active" id="task-basic-content">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                            <div>
                                                <label for="id_title" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{% trans 'Название' %} *</label>
                                                <input type="text" name="title" id="id_title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
                                            </div>
                                            <div>
                                                <label for="id_task_type" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{% trans 'Тип задания' %} *</label>
                                                <select name="task_type" id="id_task_type" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
                                                    <option value="programming">{% trans 'Программирование' %}</option>
                                                    <option value="multiple_choice">{% trans 'Тест с выбором ответа' %}</option>
                                                    <option value="theoretical">{% trans 'Теоретический вопрос' %}</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                                            <div>
                                                <label for="id_points" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{% trans 'Баллы' %} *</label>
                                                <input type="number" name="points" id="id_points" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" value="10" min="1" required>
                                            </div>
                                            <div>
                                                <label for="id_difficulty" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{% trans 'Сложность' %}</label>
                                                <select name="difficulty" id="id_difficulty" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                                    <option value="1">{% trans 'Лёгкая' %}</option>
                                                    <option value="2">{% trans 'Ниже среднего' %}</option>
                                                    <option value="3" selected>{% trans 'Средняя' %}</option>
                                                    <option value="4">{% trans 'Выше среднего' %}</option>
                                                    <option value="5">{% trans 'Сложная' %}</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label for="id_topic" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{% trans 'Тема задания' %}</label>
                                                <input type="text" name="topic" id="id_topic" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Вкладка с контентом задания -->
                                    <div class="task-form-pane hidden" id="task-content-content">
                                        <div class="flex items-center mb-4">
                                            <input id="id_use_markdown" name="use_markdown" type="checkbox" checked class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600">
                                            <label for="id_use_markdown" class="ms-2 text-sm font-medium text-gray-900 dark:text-white">{% trans 'Использовать Markdown' %}</label>
                                            
                                            <div class="ml-6 flex items-center">
                                                <input id="id_use_latex" name="use_latex" type="checkbox" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600">
                                                <label for="id_use_latex" class="ms-2 text-sm font-medium text-gray-900 dark:text-white">{% trans 'Использовать LaTeX' %}</label>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label for="id_description" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{% trans 'Описание задания' %} *</label>
                                            <textarea name="description" id="id_description" rows="10" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400" required></textarea>
                                        </div>
                                        
                                        <!-- Поля для задания программирования -->
                                        <div class="mt-6 programming-fields">
                                            <label for="id_initial_code" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{% trans 'Начальный код' %}</label>
                                            <textarea name="initial_code" id="id_initial_code" rows="8" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400" placeholder="# Начальный код, который увидит участник"></textarea>
                                        </div>
                                    </div>
                                    
                                    <!-- Вкладка с настройками -->
                                    <div class="task-form-pane hidden" id="task-settings-content">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                            <div>
                                                <label for="id_time_limit" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{% trans 'Ограничение по времени (мин)' %}</label>
                                                <input type="number" name="time_limit_minutes" id="id_time_limit" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" value="0" min="0">
                                                <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">{% trans '0 означает без ограничения' %}</p>
                                            </div>
                                            <div class="programming-fields">
                                                <label for="id_memory_limit" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{% trans 'Ограничение по памяти (МБ)' %}</label>
                                                <input type="number" name="memory_limit_mb" id="id_memory_limit" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" value="256" min="0">
                                                <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">{% trans '0 означает без ограничения' %}</p>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-6">
                                            <label for="id_solution_template" class="block text-sm font-medium text-gray-700 dark:text-gray-300 programming-fields">{% trans 'Шаблон решения' %}</label>
                                            <textarea name="solution_template" id="id_solution_template" rows="8" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 programming-fields" placeholder="# Шаблон правильного решения для проверки"></textarea>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="flex justify-end space-x-3">
                                    <button type="button" id="cancel-add-task" class="btn-secondary">
                                        <i class="fas fa-times mr-2"></i>{% trans 'Отмена' %}
                                    </button>
                                    <button type="submit" class="btn-primary">
                                        <i class="fas fa-save mr-2"></i>{% trans 'Сохранить задание' %}
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- Вкладка редактирования задания -->
                <div id="edit-task-content" class="task-tab-content hidden">
                    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-indigo-500 to-blue-600 text-white">
                            <h2 class="text-xl font-semibold flex items-center">
                                <i class="fas fa-edit mr-3"></i> {% trans 'Редактирование задания' %}:
                                <span id="edit-task-title" class="ml-2 font-normal"></span>
                            </h2>
                        </div>
                        
                        <div class="p-6">
                            <div id="edit-task-form-container">
                                <!-- Форма будет загружена динамически через AJAX -->
                                <div class="text-center py-8">
                                    <div class="animate-spin inline-block w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full"></div>
                                    <p class="mt-4 text-gray-500 dark:text-gray-400">{% trans 'Загрузка формы редактирования...' %}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Вкладка тестовых случаев -->
                <div id="test-cases-content" class="task-tab-content hidden">
                    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-teal-500 to-green-600 text-white">
                            <h2 class="text-xl font-semibold flex items-center">
                                <i class="fas fa-vial mr-3"></i> {% trans 'Тестовые случаи для задания' %}:
                                <span id="test-cases-task-title" class="ml-2 font-normal"></span>
                            </h2>
                        </div>
                        
                        <div class="p-6">
                            <div id="test-cases-container">
                                <!-- Содержимое будет загружено динамически через AJAX -->
                                <div class="text-center py-8">
                                    <div class="animate-spin inline-block w-8 h-8 border-4 border-green-600 border-t-transparent rounded-full"></div>
                                    <p class="mt-4 text-gray-500 dark:text-gray-400">{% trans 'Загрузка тестовых случаев...' %}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Секция: Участники -->
            <div id="section-participants" class="content-section">
                <!-- Содержимое раздела участников -->
            </div>
            
            <!-- Секция: Приглашения -->
            <div id="section-invitations" class="content-section">
                <!-- Содержимое раздела приглашений -->
            </div>
            
            <!-- Секция: Статистика -->
            <div id="section-statistics" class="content-section">
                <!-- Содержимое раздела статистики -->
            </div>
            
            <!-- Секция: Отчеты -->
            <div id="section-reports" class="content-section">
                <!-- Содержимое раздела отчетов -->
            </div>
            
            <!-- Секция: Статус -->
            <div id="section-status" class="content-section">
                <!-- Содержимое раздела статуса -->
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Навигация между основными секциями
        const navItems = document.querySelectorAll('.sidebar-nav-item');
        const sections = document.querySelectorAll('.content-section');
        const breadcrumbCurrent = document.getElementById('breadcrumb-current');
        
        // Функция для активации выбранной секции
        function activateSection(sectionId) {
            // Сначала скрываем все секции и деактивируем все пункты меню
            sections.forEach(section => section.classList.remove('active'));
            navItems.forEach(item => item.classList.remove('active'));
            
            // Затем активируем выбранную секцию и пункт меню
            const section = document.getElementById('section-' + sectionId);
            const navItem = document.querySelector(`[data-section="${sectionId}"]`);
            
            if (section) section.classList.add('active');
            if (navItem) {
                navItem.classList.add('active');
                // Обновляем хлебные крошки
                breadcrumbCurrent.textContent = navItem.querySelector('span').textContent;
            }
            
            // Добавляем параметр в URL
            history.pushState({section: sectionId}, '', `#${sectionId}`);
        }
        
        // Обработка клика по пунктам меню
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const sectionId = this.getAttribute('data-section');
                activateSection(sectionId);
            });
        });
        
        // Активация секции из URL при загрузке страницы
        function activateSectionFromHash() {
            const hash = window.location.hash.substring(1);
            if (hash && document.getElementById('section-' + hash)) {
                activateSection(hash);
            }
        }
        
        // Вызываем при загрузке и при изменении хеша URL
        activateSectionFromHash();
        window.addEventListener('hashchange', activateSectionFromHash);
        
        // Управление вкладками для секции заданий
        const tasksNavButtons = document.querySelectorAll('.tasks-nav-btn');
        const taskTabContents = document.querySelectorAll('.task-tab-content');
        
        // Обработчик кнопок навигации в секции заданий
        tasksNavButtons.forEach(button => {
            if (!button.disabled) {
                button.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Сначала деактивируем все вкладки и кнопки
                    taskTabContents.forEach(tab => tab.classList.add('hidden'));
                    tasksNavButtons.forEach(btn => btn.classList.remove('active-tab-btn'));
                    
                    // Затем активируем выбранную вкладку и кнопку
                    document.getElementById(`${tabId}-content`).classList.remove('hidden');
                    this.classList.add('active-tab-btn');
                });
            }
        });
        
        // Инициализация кнопок создания задания
        const addTaskBtn = document.getElementById('add-task-btn');
        const addTaskBtnInline = document.getElementById('add-task-btn-inline');
        const noTasksAddBtn = document.getElementById('no-tasks-add-btn');
        const cancelAddTaskBtn = document.getElementById('cancel-add-task');
        
        function showAddTaskTab() {
            tasksNavButtons.forEach(btn => btn.classList.remove('active-tab-btn'));
            taskTabContents.forEach(tab => tab.classList.add('hidden'));
            
            document.getElementById('add-task-btn').classList.add('active-tab-btn');
            document.getElementById('add-task-content').classList.remove('hidden');
        }
        
        function showTasksListTab() {
            tasksNavButtons.forEach(btn => btn.classList.remove('active-tab-btn'));
            taskTabContents.forEach(tab => tab.classList.add('hidden'));
            
            document.getElementById('tasks-list-btn').classList.add('active-tab-btn');
            document.getElementById('tasks-list-content').classList.remove('hidden');
        }
        
        // Обработчики для кнопок создания задания
        if (addTaskBtn) addTaskBtn.addEventListener('click', showAddTaskTab);
        if (addTaskBtnInline) addTaskBtnInline.addEventListener('click', showAddTaskTab);
        if (noTasksAddBtn) noTasksAddBtn.addEventListener('click', showAddTaskTab);
        if (cancelAddTaskBtn) cancelAddTaskBtn.addEventListener('click', showTasksListTab);
        
        // Обработка вкладок формы создания задания
        const taskFormTabs = document.querySelectorAll('#taskFormTabs [data-tab]');
        const taskFormPanes = document.querySelectorAll('.task-form-pane');
        
        taskFormTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const paneId = this.getAttribute('data-tab');
                
                // Деактивируем все вкладки и панели
                taskFormTabs.forEach(t => t.classList.remove('tab-active'));
                taskFormPanes.forEach(p => p.classList.add('hidden'));
                
                // Активируем выбранную вкладку и панель
                this.classList.add('tab-active');
                document.getElementById(`${paneId}-content`).classList.remove('hidden');
            });
        });
        
        // Изменение полей при выборе типа задания
        const taskTypeSelect = document.getElementById('id_task_type');
        const programmingFields = document.querySelectorAll('.programming-fields');
        
        if (taskTypeSelect) {
            taskTypeSelect.addEventListener('change', function() {
                const selectedType = this.value;
                
                if (selectedType === 'programming') {
                    programmingFields.forEach(field => field.style.display = 'block');
                } else {
                    programmingFields.forEach(field => field.style.display = 'none');
                }
            });
        }
        
        // Инициализация кнопок редактирования и тестовых случаев
        const taskRows = document.querySelectorAll('.task-row');
        const editTaskBtns = document.querySelectorAll('.edit-task-btn');
        const testCasesBtns = document.querySelectorAll('.test-cases-btn');
        const deleteTaskBtns = document.querySelectorAll('.delete-task-btn');
        
        // Выбор задания
        let selectedTaskId = null;
        let selectedTaskTitle = null;
        let selectedTaskType = null;
        
        function selectTask(taskId, taskTitle, taskType) {
            selectedTaskId = taskId;
            selectedTaskTitle = taskTitle;
            selectedTaskType = taskType;
            
            // Активируем кнопки управления заданием
            document.getElementById('edit-task-btn').disabled = false;
            document.getElementById('edit-task-btn').classList.remove('btn-secondary');
            document.getElementById('edit-task-btn').classList.add('btn-primary');
            
            // Для заданий программирования активируем кнопку тестов
            if (taskType === 'programming') {
                document.getElementById('test-cases-btn').disabled = false;
                document.getElementById('test-cases-btn').classList.remove('btn-secondary');
                document.getElementById('test-cases-btn').classList.add('btn-primary');
            } else {
                document.getElementById('test-cases-btn').disabled = true;
                document.getElementById('test-cases-btn').classList.add('btn-secondary');
                document.getElementById('test-cases-btn').classList.remove('btn-primary');
            }
            
            // Помечаем выбранную строку
            taskRows.forEach(row => {
                row.classList.remove('bg-blue-50', 'dark:bg-blue-900/20');
                if (row.dataset.taskId === taskId) {
                    row.classList.add('bg-blue-50', 'dark:bg-blue-900/20');
                }
            });
        }
        
        // Обработчики для кнопок редактирования
        editTaskBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const row = this.closest('.task-row');
                const taskId = row.dataset.taskId;
                const taskTitle = row.dataset.taskTitle;
                const taskType = row.dataset.taskType;
                
                selectTask(taskId, taskTitle, taskType);
                
                // Отображаем форму редактирования
                document.getElementById('edit-task-title').textContent = taskTitle;
                
                // Переходим на вкладку редактирования
                tasksNavButtons.forEach(btn => btn.classList.remove('active-tab-btn'));
                taskTabContents.forEach(tab => tab.classList.add('hidden'));
                
                document.getElementById('edit-task-btn').classList.add('active-tab-btn');
                document.getElementById('edit-task-content').classList.remove('hidden');
                
                // Здесь можно добавить AJAX-запрос для загрузки формы редактирования
                // Например:
                // fetch(`/olympiads/manage/${olympiad.id}/tasks/${taskId}/edit_form/`)
                //     .then(response => response.text())
                //     .then(html => {
                //         document.getElementById('edit-task-form-container').innerHTML = html;
                //     });
            });
        });
        
        // Обработчики для кнопок тестовых случаев
        testCasesBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const row = this.closest('.task-row');
                const taskId = row.dataset.taskId;
                const taskTitle = row.dataset.taskTitle;
                const taskType = row.dataset.taskType;
                
                if (taskType !== 'programming') return;
                
                selectTask(taskId, taskTitle, taskType);
                
                // Отображаем тестовые случаи
                document.getElementById('test-cases-task-title').textContent = taskTitle;
                
                // Переходим на вкладку тестовых случаев
                tasksNavButtons.forEach(btn => btn.classList.remove('active-tab-btn'));
                taskTabContents.forEach(tab => tab.classList.add('hidden'));
                
                document.getElementById('test-cases-btn').classList.add('active-tab-btn');
                document.getElementById('test-cases-content').classList.remove('hidden');
                
                // Здесь можно добавить AJAX-запрос для загрузки тестовых случаев
                // Например:
                // fetch(`/olympiads/manage/${olympiad.id}/tasks/${taskId}/test_cases/`)
                //     .then(response => response.text())
                //     .then(html => {
                //         document.getElementById('test-cases-container').innerHTML = html;
                //     });
            });
        });
        
        // Обработчики для кнопок удаления
        deleteTaskBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const row = this.closest('.task-row');
                const taskId = row.dataset.taskId;
                const taskTitle = row.dataset.taskTitle;
                
                if (confirm(`Вы уверены, что хотите удалить задание "${taskTitle}"?`)) {
                    // Здесь можно добавить отправку формы или AJAX-запрос для удаления задания
                    // Например:
                    // fetch(`/olympiads/manage/${olympiad.id}/tasks/${taskId}/delete/`, {
                    //     method: 'POST',
                    //     headers: {
                    //         'X-CSRFToken': getCookie('csrftoken')
                    //     }
                    // }).then(response => {
                    //     if (response.ok) {
                    //         row.remove();
                    //     }
                    // });
                }
            });
        });
    });
</script>
{% endblock %}